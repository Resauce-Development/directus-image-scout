import{defineInterface as e}from"@directus/extensions-sdk";import{resolveComponent as a,openBlock as t,createElementBlock as n,createVNode as i,createElementVNode as r,renderSlot as s,createBlock as o,withCtx as c,normalizeClass as d,normalizeStyle as l,toDisplayString as g,createCommentVNode as u,withKeys as m,withModifiers as v,Fragment as h,renderList as p,resolveDirective as f,createTextVNode as b,withDirectives as y}from"vue";var _={name:"ris-fullpage-loader"};const S={class:"v-fullpage-loader"};var k=[],w=[];function x(e,a){if(e&&"undefined"!=typeof document){var t,n=!0===a.prepend?"prepend":"append",i=!0===a.singleTag,r="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(i){var s=k.indexOf(r);-1===s&&(s=k.push(r)-1,w[s]={}),t=w[s]&&w[s][n]?w[s][n]:w[s][n]=o()}else t=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var t=Object.keys(a.attributes),i=0;i<t.length;i++)e.setAttribute(t[i],a.attributes[t[i]]);var s="prepend"===n?"afterbegin":"beforeend";return r.insertAdjacentElement(s,e),e}}x("\n.v-fullpage-loader[data-v-7c48d9e3] {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--background-normal);\n  z-index: 10;\n}\n.v-progress-circular[data-v-7c48d9e3] {\n  margin-bottom: var(--v-card-padding);\n}\n",{}),_.render=function(e,o,c,d,l,g){const u=a("v-progress-circular");return t(),n("div",S,[i(u,{"x-large":"",indeterminate:""}),r("p",null,[s(e.$slots,"default")])])},_.__scopeId="data-v-7c48d9e3",_.__file="src/interface/components/RISFullpageLoader.vue";var I={name:"ris-image-preview",props:{image:{type:Object,required:!0}}};const P=["src"];x("\n.image[data-v-5bf5d602] {\n  max-height: 90vh;\n  max-width: 90vw;\n  height: auto;\n  width: auto;\n}\n",{}),I.render=function(e,n,i,s,d,l){const g=a("v-overlay");return t(),o(g,{active:!!i.image,onClick:n[0]||(n[0]=a=>e.$emit("close",i.image))},{default:c((()=>[r("img",{class:"image",src:i.image.url_preview},null,8,P)])),_:1},8,["active"])},I.__scopeId="data-v-5bf5d602",I.__file="src/interface/components/RISImagePreview.vue";var O={name:"ris-image",props:{image:{type:Object,required:!0},imagesSelected:{type:Array}},data:()=>({height:"auto",needsSetHeight:!0}),computed:{isSelected(){return this.imagesSelected.includes(this.image.id)}},methods:{triggerRender(){this.height="auto",this.$refs.img.dataset.risRendered=!0,setTimeout((()=>this.$el.dataset.risRendered=!0),500)}},mounted(){const e=this.$el.clientWidth,a=this.image.width,t=this.image.height;this.height=Math.round(t/a*e)+"px"}};const C=["src","alt"],$={class:"attribution-link"};x('\n.btn-action[data-v-35eec0b9] {\n  padding: 0;\n  min-width: 0;\n\n  --v-button-color: #fff;\n  --v-button-color-hover: #ffffff99;\n  --v-button-color-activated: #ffffff99;\n  --v-button-color-disabled: #ffffffaa;\n\n  --v-button-background-color: transparent;\n  --v-button-background-color-hover: transparent;\n  --v-button-background-color-activated: transparent;\n  --v-button-background-color-disabled: transparent;\n}\n.btn-action[data-v-35eec0b9] .button.x-small {\n  padding: 0;\n}\n.btn-action-icon[data-v-35eec0b9] {\n  margin-right: 5px;\n}\n.attribution-link[data-v-35eec0b9] {\n  max-width: 145px;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n.container .v-card[data-v-35eec0b9] {\n  --ris-transition-time: 0.5s;\n  --v-card-min-width: 0;\n  --v-card-padding: 15px;\n  background: var(--background-normal);\n  break-inside: avoid-column;\n  margin-bottom: 5%;\n  position: relative;\n  overflow: hidden;\n  border-radius: var(--border-radius);\n  transition: transform var(--ris-transition-time);\n}\n.container .v-card img[data-v-35eec0b9] {\n  width: 100%;\n  height: auto;\n  vertical-align: middle;\n  border-radius: 0 !important;\n\n  opacity: 0;\n  transition: opacity var(--ris-transition-time);\n}\n.container .v-card img[data-ris-rendered="true"][data-v-35eec0b9] {\n  opacity: 1;\n}\n.container .v-card[data-v-35eec0b9]:hover {\n  transform: scale(0.975);\n}\n.card-hover-details[data-v-35eec0b9] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  background-image: linear-gradient(0, black -25%, transparent 75%);\n  height: 100%;\n  width: 100%;\n  padding: calc(var(--v-card-padding) / 2);\n\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-end;\n\n  opacity: 0;\n  pointer-events: none;\n}\n.card-hover-details--active[data-v-35eec0b9],\n.v-card:hover .card-hover-details[data-v-35eec0b9] {\n  opacity: 1;\n  pointer-events: all;\n}\n.v-card[data-v-35eec0b9],\n.v-card--is-selected[data-v-35eec0b9],\n.card-hover-details[data-v-35eec0b9],\n.v-card:hover .card-hover-details[data-v-35eec0b9] {\n  transition: all var(--ris-transition-time);\n}\n.container .v-card[data-ris-rendered="true"][data-v-35eec0b9] {\n  --checkerSize: 10px;\n  --checkerColor: lightgrey;\n  --checkerAltColor: var(--background-normal);\n\n  background-image:\n    linear-gradient(45deg, var(--checkerColor) 25%, transparent 25%),\n    linear-gradient(135deg, var(--checkerColor) 25%, transparent 25%),\n    linear-gradient(45deg, transparent 75%, var(--checkerColor) 75%),\n    linear-gradient(135deg, transparent 75%, var(--checkerColor) 75%);\n  background-color: var(--checkerAltColor);\n\n  background-size:\n    calc(2 * var(--checkerSize)) calc(2 * var(--checkerSize));\n\n  background-position:\n    0 0,\n    var(--checkerSize) 0,\n    var(--checkerSize) calc(-1 * var(--checkerSize)),\n    0px var(--checkerSize);\n}\n',{}),O.render=function(e,n,s,m,v,h){const p=a("v-icon"),f=a("v-button"),b=a("v-card");return t(),o(b,{class:d({"v-card--is-selected":h.isSelected})},{default:c((()=>[r("img",{ref:"img",style:l({height:v.height}),src:s.image.url_thumb,alt:s.image.description,onLoad:n[0]||(n[0]=(...e)=>h.triggerRender&&h.triggerRender(...e))},null,44,C),r("div",{class:d(["card-hover-details",{"card-hover-details--active":h.isSelected}])},[r("div",null,[s.image.attribution?(t(),o(f,{key:0,class:"btn-action","x-small":"",href:s.image.attribution.url,title:s.image.attribution.name},{default:c((()=>[i(p,{name:"link",class:"btn-action-icon"}),r("span",$,g(s.image.attribution.name),1)])),_:1},8,["href","title"])):u("v-if",!0)]),r("div",null,[s.image.url_preview?(t(),o(f,{key:0,class:"btn-action","x-small":"",icon:"",onClick:n[1]||(n[1]=a=>e.$emit("preview",s.image))},{default:c((()=>[i(p,{name:"zoom_in"})])),_:1})):u("v-if",!0),i(f,{class:"btn-action","x-small":"",icon:"",disabled:!s.image.url_download,onClick:n[2]||(n[2]=a=>e.$emit("select",s.image))},{default:c((()=>[i(p,{name:h.isSelected?"check_circle":"radio_button_unchecked"},null,8,["name"])])),_:1},8,["disabled"])])],2)])),_:1},8,["class"])},O.__scopeId="data-v-35eec0b9",O.__file="src/interface/components/RISImage.vue";var q={name:"ris-image-grid",components:{"ris-image-preview":I,"ris-image":O},props:{images:{type:Array,required:!0},imagesSelected:{type:Array}},data:()=>({previewImage:null})};const L={key:1,class:"image-grid"};x("\n.image-grid[data-v-67b0a49f] {\n  column-count: 1;\n}\n\n/* Extra small devices (phones, 600px and down) */\n@media only screen and (min-width: 600px) {\n.image-grid[data-v-67b0a49f] {\n    column-count: 2;\n}\n}\n\n/* Large devices (laptops/desktops, 992px and up) */\n@media only screen and (min-width: 992px) {\n.image-grid[data-v-67b0a49f] {\n    column-count: 3;\n}\n}\n",{}),q.render=function(e,i,r,s,c,d){const l=a("ris-image-preview"),g=a("ris-image");return t(),n("div",null,[c.previewImage?(t(),o(l,{key:0,image:c.previewImage,onClose:i[0]||(i[0]=e=>c.previewImage=null),onKeyup:i[1]||(i[1]=m(v((e=>c.previewImage=null),["prevent"]),["esc"]))},null,8,["image"])):u("v-if",!0),r.images&&r.images.length>0?(t(),n("div",L,[(t(!0),n(h,null,p(r.images,((a,n)=>(t(),o(g,{key:`${n}__${a.url_thumb}`,image:a,"images-selected":r.imagesSelected,onPreview:e=>c.previewImage=a,onSelect:t=>e.$emit("select",a)},null,8,["image","images-selected","onPreview","onSelect"])))),128))])):u("v-if",!0)])},q.__scopeId="data-v-67b0a49f",q.__file="src/interface/components/RISImageGrid.vue";class F{constructor(e){this.provider=e}exists(e){return!!this.fetch(e)}fetch(e){const a=sessionStorage.getItem(e);return a?JSON.parse(a):null}save(e,a){return sessionStorage.setItem(e,JSON.stringify(a))}}var z={name:"resauce-image-scout",inject:["api"],emits:["input"],components:{"ris-fullpage-loader":_,"ris-image-grid":q},mixins:[{data:()=>({apiPrefix:"/resauce-image-scout",providerList:[],providerSelected:null}),computed:{queryCache(){return new F(this.providerSelected)}},methods:{getProviders(){return this.api.get(`${this.apiPrefix}/providers`).then((({data:e})=>{this.providerList=e.data.filter((e=>e.is_configured)),this.providerSelected=this.providerList[0].key})).catch((e=>console.error("🎨❌ Fetching Providers Failed",e)))},fetchFromCache(e){return new Promise(((a,t)=>{try{a(this.queryCache.fetch(e))}catch(e){t(e)}}))},getSearch(e,a){const t=`${this.apiPrefix}/providers/${this.providerSelected}/search?query=${e}&page=${a}`;return this.queryCache.exists(t)?(console.info("🎨 Searching cache",e,a),this.fetchFromCache(t).then((e=>e))):(console.info("🎨 Searching provider",e,a),this.api.get(t).then((({data:e})=>(this.queryCache.save(t,e),e))))},getFeatured(){const e=`${this.apiPrefix}/providers/${this.providerSelected}/featured`;return this.queryCache.exists(e)?(console.info("🎨 Loading featured from cache"),this.fetchFromCache(e).then((e=>e))):(console.info("🎨 Loading featured from provider"),this.api.get(e).then((({data:a})=>(this.queryCache.save(e,a),a))))},triggerDownload(e,a){const t=`${this.apiPrefix}/providers/${this.providerSelected}/download`;return this.api.post(t,{image:e,access_token:a}).then((({data:e})=>e))}}}],props:["value","type","group"],data:()=>({search:"",last_used_query:"",last_used_provider:null,isModalOpen:!1,processing:!1,imagesSelected:[],images:null,countOfPages:null,countOfImages:null,current_page:1,fetch_limit:30,request_time:0}),computed:{providerLastSelected(){return this.last_used_provider?this.providerList.find((e=>e.key===this.last_used_provider)):this.providerList.find((e=>e.key===this.providerSelected))},user_access_token(){return this.api.defaults.headers.common.Authorization.replace("Bearer ","")}},methods:{selectImage(e){const a=e.id;"files"===this.group?this.imagesSelected.includes(a)?this.imagesSelected.splice(this.imagesSelected.indexOf(a),1):this.imagesSelected.push(a):this.imagesSelected.includes(a)?this.imagesSelected=[]:(this.imagesSelected=[],this.imagesSelected.push(a))},downloadSelected(){this.processing=!0;const e=this.images.find((e=>e.id===this.imagesSelected[0]));this.triggerDownload(e,this.user_access_token).then((({data:e})=>{this.$emit("input",e.data.id),this.processing=!1,this.isModalOpen=!1})).catch((e=>console.error("🎨 Failed to import image")))},getPhotos(e,a,t=1){if(e||(this.images=null),e.length<1)return this.getProviderFeaturedPhotos();this.imagesSelected=[],this.search=this.last_used_query=e,this.providerSelected=this.last_used_provider=a,this.current_page=t,this.processing=!0;const n=performance.now();this.getSearch(e,t).then((({data:e})=>{this.countOfImages=e.countOfImages,this.countOfPages=e.countOfPages,this.images=e.images,this.processing=!1;const a=performance.now();this.request_time=parseFloat((a-n)/1e3).toFixed(12)}))},getProviderFeaturedPhotos(){this.processing=!0,this.getFeatured().then((({data:e})=>{this.countOfImages=e.countOfImages,this.countOfPages=e.countOfPages,this.images=e.images,this.processing=!1}))}},mounted(){this.getProviders().then((()=>this.getProviderFeaturedPhotos()))}};const V={class:"v-resauce-image-scout"},A={class:"display"},j=["src"],R={class:"drawer--content"},M={class:"drawer--search"},N={class:"header-search-area"},T={class:"header-search--provider"},B={key:0,class:"header-search-detail"},E={key:0,class:"drawer--images"},U={key:0,class:"v-paginator"},D={class:"api-supplier"},K=["href"],J={key:1,class:"container-error"};x("\n.display[data-v-1b566c1a] {\n  display: flex;\n}\n.v-avatar[data-v-1b566c1a] {\n  margin-right: var(--input-padding);\n}\n\n/* Modal Stuff */\n.api-supplier[data-v-1b566c1a] {\n  text-align: center;\n  font-size: 8px;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  margin-top: calc(var(--v-card-padding) * 2);\n}\n.icon-search[data-v-1b566c1a] {\n  color: var(--background-normal);\n}\n.v-drawer[data-v-1b566c1a] {\n  position: relative;\n}\n.drawer--content[data-v-1b566c1a] {\n  padding: var(--v-card-padding);\n}\n.ris-fullpage-loader[data-v-1b566c1a] {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--background-normal);\n  z-index: 1;\n  opacity: 0.95;\n}\n.header-search-area[data-v-1b566c1a] {\n  display: flex;\n}\n.header-search-detail[data-v-1b566c1a] {\n  font-size: 10px;\n  color: var(--border-normal-alt);\n}\n.header-search--provider[data-v-1b566c1a] {\n  min-width: 25%;\n  margin-left: 15px;\n}\n.v-paginator[data-v-1b566c1a] {\n  margin: var(--v-card-padding) auto;\n  margin-top: calc(var(--v-card-padding) * 2);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.v-pagination[data-v-1b566c1a] {\n  margin: auto;\n}\n.drawer--images[data-v-1b566c1a] {\n  margin: var(--v-card-padding) 0;\n}\n.container-error[data-v-1b566c1a] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n  flex-direction: column;\n  height: calc(100vh - 30vh);\n}\n",{}),z.render=function(e,s,d,l,v,h){const p=a("v-icon"),_=a("v-avatar"),S=a("v-button"),k=a("ris-fullpage-loader"),w=a("v-input"),x=a("v-select"),I=a("ris-image-grid"),P=a("v-pagination"),O=a("v-info"),C=a("v-drawer"),$=f("tooltip");return t(),n("div",V,[r("div",A,[i(_,{class:"v-avatar","x-large":""},{default:c((()=>[d.value?(t(),n("img",{key:0,src:`/assets/${d.value}?key=system-medium-cover&access_token=${h.user_access_token}`},null,8,j)):(t(),o(p,{key:1,name:"image_search"}))])),_:1}),i(S,{onClick:s[0]||(s[0]=e=>v.isModalOpen=!0),outlined:!0,dashed:!d.value,small:""},{default:c((()=>[b(g(d.value?"Replace Image":"Browse Images"),1)])),_:1},8,["dashed"])]),i(C,{class:"v-drawer",title:"Image Scout",icon:"image_search",modelValue:v.isModalOpen,"onUpdate:modelValue":s[8]||(s[8]=e=>v.isModalOpen=e),onCancel:s[9]||(s[9]=e=>v.isModalOpen=!1)},{actions:c((()=>[y((t(),o(S,{onClick:h.downloadSelected,icon:"",rounded:"",primary:""},{default:c((()=>[i(p,{name:"done"})])),_:1},8,["onClick"])),[[$,"Save",void 0,{bottom:!0}]])])),default:c((()=>[v.processing?(t(),o(k,{key:0},{default:c((()=>[b(" Please wait while we process your request... ")])),_:1})):u("v-if",!0),r("div",R,[r("div",M,[r("div",N,[i(w,{modelValue:v.search,"onUpdate:modelValue":s[1]||(s[1]=e=>v.search=e),class:"header-search--bar",placeholder:"Search for image keywords...",onKeyup:s[2]||(s[2]=m((a=>h.getPhotos(v.search,e.providerSelected)),["enter"]))},{append:c((()=>[i(p,{name:"search"})])),_:1},8,["modelValue"]),r("div",T,[i(x,{modelValue:e.providerSelected,"onUpdate:modelValue":s[3]||(s[3]=a=>e.providerSelected=a),items:e.providerList,"item-value":"key","item-text":"name",onInput:s[4]||(s[4]=a=>v.search.length>0?h.getPhotos(v.search,e.providerSelected):h.getProviderFeaturedPhotos())},null,8,["modelValue","items"])])]),v.countOfPages?(t(),n("p",B,g(h.providerLastSelected.name)+" returned "+g(v.countOfImages.toLocaleString())+' results for "'+g(v.last_used_query)+'" in '+g(v.request_time)+" seconds ",1)):u("v-if",!0)]),v.images&&v.images.length>0?(t(),n("div",E,[i(I,{images:v.images,"images-selected":v.imagesSelected,onSelect:s[5]||(s[5]=e=>h.selectImage(e))},null,8,["images","images-selected"]),v.countOfPages&&v.countOfPages>1?(t(),n("div",U,[i(P,{modelValue:v.current_page,"onUpdate:modelValue":s[6]||(s[6]=e=>v.current_page=e),length:v.countOfPages,"total-visible":5,"show-first-last":!0,onInput:s[7]||(s[7]=e=>h.getPhotos(v.last_used_query,v.last_used_provider,e))},null,8,["modelValue","length"])])):u("v-if",!0),r("p",D,[b(" Image library powered by "),r("a",{href:h.providerLastSelected.url,target:"_BLANK"},g(h.providerLastSelected.name),9,K)])])):(t(),n("div",J,[i(O,{icon:"image_search",title:"No results",type:"warning"},{default:c((()=>[b(" Sorry, we couldn't retrieve any images for you, please try to refine your search ")])),_:1})]))])])),_:1},8,["modelValue"])])},z.__scopeId="data-v-1b566c1a",z.__file="src/interface/interface.vue";var G=e({id:"resauce-image-scout",name:"Image Scout",icon:"image_search",description:"Search and use images from online libraries",component:z,options:null,types:["uuid"],localTypes:["file","files"],group:"relational",recommendedDisplays:["image"],relational:!0});export{G as default};
//# sourceMappingURL=index.js.map
